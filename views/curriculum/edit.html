{% extends "layouts/main.html" %}

{% block body %}
<h1>{{thisCurriculum.subject}}</h1>
<form class="form" id="newSubject" action="/curriculum/{{thisCurriculum._id}}" method="POST">
	<button class="btn btn-success">Save</button>

	<div class="form-group">
	    <label for="new_subject_name">Subject:</label>
	    <input type="text" class="form-control" required id="new_subject_name" value="{{thisCurriculum.subject}}" autofocus name="subject">
	</div>

	<div class="form-group">
	    <label for="overview">Overview:</label>
	    <textarea class="form-control" name="overview" id="overview" rows="3">{{thisCurriculum.overview}}</textarea>
	</div>

	<div class="form-group">
	    <label for="dependancies">Dependencies:</label>
	    <select multiple class="form-control" name="dependencies" id="dependencies">
		    {% for c in curriculum %}
				<option value="{{c.id}}">{{c.subject}}</option>
			{% endfor %}
		</select>
	</div>

	<h3>Resources</h3>
	<div id="resources" class="form-inline">
		<div class="form-group">
			<a class="delete_resource btn btn-danger"><span class="glyphicon glyphicon-remove"></span></a>
		    <input type="url" class="form-control form-inline" id="resource" placeholder="Link" name="resource">
		    <input type="text" class="form-control form-inline" id="resource-text" placeholder="Link Text" name="resource-text">
		</div>
	</div>
	<a id="new_resource" class="btn btn-success"><span class="glyphicon glyphicon-plus"></span></a>

	<h3>Examples</h3>
	<div id="examples" class="form-inline">
		<div class="form-group" id="example">
			<a id="delete_example" class="delete_example btn btn-danger"><span class="glyphicon glyphicon-remove"></span></a>
		    <input type="url" class="form-control form-inline" id="example" placeholder="Link" name="example">
		    <input type="text" class="form-control form-inline" id="example-text" placeholder="Link Text" name="example-text">
		</div>
	</div>
	<a id="new_example" class="btn btn-success"><span class="glyphicon glyphicon-plus"></span></a>

	<h3>Related Assignments</h3>
	<p>This just ties together assignments you might want to assign students if you do this topic.</p>
	<div id="assignments">
		<select multiple class="form-control" name="assignments" >
			{% for assignment in assignments %}
				<option value="{{assignment._id}}" {% if thisCurriculum.assignments.indexOf(assignment._id) > -1 %} selected="true" {%endif%}>{{assignment.title}}</option>
			{% endfor %}
		</select>
	</div>


	<div class="form-group">
	    <label for="new_subject_name">Awesome Gif:</label>
	    <p>Every curriculum is better with an awesome gif. Find or make one and it will appear to the side of the title.</p>
	    <input type="url" class="form-control" id="gif_link" placeholder="Gif Link Here" name="gif">
	</div>
</form>

{% endblock %}

{% block javascript %}
<script type="text/javascript">

	//Resources, event handlers and new dom element creation
	$('#new_resource').on('click', function(e) {
		e.preventDefault();
		$('#resources').append(newLinkGroup({name: 'resource'}));

		$('.delete_resource').on('click', function(e) {
			e.preventDefault();
			$(this).parent().remove();
		});
	});

	//setup from server-side data
	{% for r in thisCurriculum.resources %}
		$('#resources').html("") //empty first, since there is one there already
		$('#resources').append(newLinkGroup({name:'resource', link: "{{r.link}}", linkText: "{{r.linkText}}" }));
	{% endfor %}

	//After all the data-driven ones have been created bind click handlers
	$('.delete_resource').on('click', function(e) {
		e.preventDefault();
		$(this).parent().remove();
	});

	//Examples, event handlers and new dom element creation
	$('#new_example').on('click', function(e) {
		e.preventDefault();
		$('#examples').append(newLinkGroup({name: 'example'}));

		$('.delete_example').on('click', function(e) {
			e.preventDefault();
			$(this).parent().remove();
		});
	});

	//setup from server-side data
	{% for e in thisCurriculum.examples %}
		$('#examples').html(""); //empty first, since there is one there already
		$('#examples').append(newLinkGroup({name:'example', link: "{{e.link}}", linkText: "{{e.linkText}}" }));
	{% endfor %}

	//After all the data-driven ones have been created bind click handlers
	$('.delete_example').on('click', function(e) {
		e.preventDefault();
		$(this).parent().remove();
	});

 

	//Gives me a new link + link text and remove button
	function newLinkGroup (options) {
		if (options.link && options.linkText) {
			return $('<div class="form-group"><a class="delete_'+options.name+' btn btn-danger"><span class="glyphicon glyphicon-remove"></span></a><input type="text" class="form-control form-inline" id="'+options.name+'" value="'+options.link+'" name="'+options.name+'"><input type="text" class="form-control form-inline" id="'+options.name+'-text" value="'+options.linkText+'" name="'+options.name+'-text"></div>')
		} else {
			return $('<div class="form-group"><a class="delete_'+options.name+' btn btn-danger"><span class="glyphicon glyphicon-remove"></span></a><input type="text" class="form-control form-inline" id="'+options.name+'" placeholder="Link" name="'+options.name+'"><input type="text" class="form-control form-inline" id="'+options.name+'-text" placeholder="Link Text" name="'+options.name+'-text"></div>')
		}
		
	}
</script>

{% endblock %}